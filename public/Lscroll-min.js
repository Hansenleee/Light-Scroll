!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Lscroll=i()}(this,function(){"use strict";let t=0;const i=["webkit","moz"];for(let t=0;t<i.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[`${i[t]}RequestAnimationFrame`],window.cancelAnimationFrame=window[`${i[t]}CancelAnimationFrame`]||window[`${i[t]}CancelRequestAnimationFrame`];function n(t,i,n,o=!1){document.addEventListener?t.addEventListener(i,n,o):document.attachEvent?t.attachEvent("on"+i,n):t["on"+i]=n}function o(t,i,n,o=!1){document.removeEventListener?t.removeEventListener(i,n,o):document.detachEvent?t.detachEvent("on"+i,n):t["on"+i]=null}window.requestAnimationFrame||(window.requestAnimationFrame=function(i){const n=(new Date).getTime(),o=Math.max(0,16.7-(n-t)),e=window.setTimeout(()=>{i(n+o)},o);return t=n+o,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});let e=[];var s={active:!1,setEvent(t,...i){Array.isArray(t)?t.forEach(t=>{e.push(t.bind(null,...i))}):e.push(t.bind(null,...i)),this.active||(this.active=!0,this.start())},start(t=0){const i=e[t];if(i){const n=i();(n||{}).then?n.then(()=>{this.start(++t)}):this.start(++t)}else e=[],this.active=!1}},h={transition(t,i,n=1,o){let e=t;const s=()=>{e>i&&n>0||e<i&&n<0||(o(e+=n),window.requestAnimationFrame(s))};window.requestAnimationFrame(s)}};function c(t,i){this.wrapper="string"==typeof t?document.querySelector(t):t,this.container=this.wrapper.children[0],this._init(i)}return(t=>{t.PULLDOWN_TOP=180,t.PULLDOWN_FRESH=120,t.PULLDOWN_BACK_TIME=500,t.PULLDONG_LOAD_THRESHOLD=100,t.prototype._init=function(t={}){this.options=t,this._session=t.session||!1,this._pullUpLoad=t.pullUpLoad||!1;const i=t.pullDownRefresh;this._pullDownRefresh=!!i||!1,this.beforePullingDown=!0,this.isPullingDown=!1,this.onPullUpLoading=!1,this.showFooter=!1,this.touchDistanceY=0,this.onTouch=!1,this.startY=0,this.events={},this.isDestory=!1;const o=s.setEvent;if(this._pullUpLoad){const t=o.bind(s,this._onScroll.bind(this));n(this.wrapper,"scroll",t)}if(this._pullDownRefresh){const t=this.container;n(t,"touchstart",o.bind(s,this._touchStart.bind(this))),n(t,"touchmove",o.bind(s,this._touchMove.bind(this))),n(t,"touchend",o.bind(s,this._touchEnd.bind(this))),n(t,"touchcancel",o.bind(s,this._touchEnd.bind(this)))}}})(c),(t=>{t.prototype.on=function(t,i){this.events[t]?this.events[t].push(i):this.events[t]=[i]},t.prototype.emit=function(t,i){const n=this.events;n[t]&&s.setEvent(n[t],i)},t.prototype.finishLoad=function(){this.isPullingDown?this._finishPullDown():this.onPullUpLoading&&this._finishPullUp()},t.prototype.refresh=function(){this._init()},t.prototype.destory=function(){this.destory=!0;const t=s.setEvent,i=this.container;o(this.wrapper,"scroll",t.bind(this.wrapper,this._onScroll)),o(i,"touchstart",t.bind(i,this._touchStart)),o(i,"touchmove",t.bind(i,this._touchMove)),o(i,"touchend",t.bind(i,this._touchEnd)),o(i,"touchcancel",t.bind(i,this._touchEnd)),this.wrapper=null,this.container=null}})(c),(t=>{t.prototype._pullingUpLoad=function(){this.onPullUpLoading=!0,this.emit("loadMore")},t.prototype._finishPullUp=function(){this.onPullUpLoading=!1},t.prototype._pullingFresh=function(){this.isPullingDown=!0,this.beforePulldingDown=!1,this.onTouch=!1,h.transition(this.touchDistanceY,this.constructor.PULLDOWN_FRESH,-10,this._touchMoveY.bind(this)),this.emit("refresh")},t.prototype._finishPullDown=function(){this.isPullingDown=!1,setTimeout(()=>{this.beforePulldingDown=!0},this.constructor.PULLDOWN_BACK_TIME),this._resetTouch()}})(c),(t=>{t.prototype._onScroll=function(){const t=this.wrapper,i=this._pullUpLoad.threshold||this.constructor.PULLDONG_LOAD_THRESHOLD;t.scrollTop+t.offsetHeight+i>=t.scrollHeight&&!this.onPullUpLoading&&this._pullingUpLoad()},t.prototype._touchStart=function(t){const i=t.touches[0];this.startY=i.clientY,this.onTouch=!0,this._touchMoveY(0)},t.prototype._touchMove=function(t){if(!this.onTouch)return!1;const i=this.wrapper.scrollTop,n=t.touches[0].clientY,o=n-this.startY;return this.startY=n,0!==i||o<0&&0===this.touchDistanceY?this._touchEndHandler():(t.preventDefault(),this._touchMoveY(this.touchDistanceY+o),this.touchDistanceY>=this.constructor.PULLDOWN_TOP?this._pullingFresh():void 0)},t.prototype._touchEnd=function(){return this.touchDistanceY>=this.constructor.PULLDOWN_FRESH&&this.onTouch?this._pullingFresh():this._touchEndHandler(),this._session&&this._storeScroll()},t.prototype._touchEndHandler=function(){this.isPullingDown||(this.onTouch=!1,this.touchDistanceY>0&&this._resetTouch())},t.prototype._resetTouch=function(){h.transition(this.touchDistanceY,0,-10,this._touchMoveY.bind(this))},t.prototype._touchMoveY=function(t){this.touchDistanceY=t,this.emit("touchMove",t)},t.prototype._storeScroll=function(){}})(c),c});
