!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Lscroll=i()}(this,function(){"use strict";for(var t=0,i=["webkit","moz"],n=0;n<i.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[i[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[n]+"CancelAnimationFrame"]||window[i[n]+"CancelRequestAnimationFrame"];function o(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];document.addEventListener?t.addEventListener(i,n,o):document.attachEvent?t.attachEvent("on"+i,n):t["on"+i]=n}function e(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];document.removeEventListener?t.removeEventListener(i,n,o):document.detachEvent?t.detachEvent("on"+i,n):t["on"+i]=null}window.requestAnimationFrame||(window.requestAnimationFrame=function(i){var n=(new Date).getTime(),o=Math.max(0,16.7-(n-t)),e=window.setTimeout(function(){i(n+o)},o);return t=n+o,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});var s=[],h={active:!1,setEvent:function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];Array.isArray(t)?t.forEach(function(t){s.push(t.bind.apply(t,[null].concat(n)))}):s.push(t.bind.apply(t,[null].concat(n))),this.active||(this.active=!0,this.start())},start:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=s[i];if(n){var o=n();(o||{}).then?o.then(function(){t.start(++i)}):this.start(++i)}else s=[],this.active=!1}},r=function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments[3],e=t;window.requestAnimationFrame(function t(){e>i&&n>0||e<i&&n<0||(o(e+=n),window.requestAnimationFrame(t))})};function c(t,i){this.wrapper="string"==typeof t?document.querySelector(t):t,this.container=this.wrapper.children[0],this._init(i)}return function(t){t.PULLDOWN_TOP=180,t.PULLDOWN_FRESH=120,t.PULLDOWN_BACK_TIME=500,t.PULLDONG_LOAD_THRESHOLD=100,t.SESSION_KEY_PREFIX="LSCROLL_",t.prototype._init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,this._session=t.session||!1,this._pullUpLoad=t.pullUpLoad||!1;var i=t.pullDownRefresh;this._pullDownRefresh=!!i||!1,this.beforePullingDown=!0,this.isPullingDown=!1,this.onPullUpLoading=!1,this.showFooter=!1,this.touchDistanceY=0,this.onTouch=!1,this.startY=0,this.events={},this.isDestory=!1;var n=h.setEvent;if(this._pullUpLoad){var e=n.bind(h,this._onScroll.bind(this));o(this.wrapper,"scroll",e)}if(this._pullDownRefresh){var s=this.container;o(s,"touchstart",n.bind(h,this._touchStart.bind(this))),o(s,"touchmove",n.bind(h,this._touchMove.bind(this))),o(s,"touchend",n.bind(h,this._touchEnd.bind(this))),o(s,"touchcancel",n.bind(h,this._touchEnd.bind(this)))}}}(c),function(t){t.prototype.on=function(t,i){this.events[t]?this.events[t].push(i):this.events[t]=[i]},t.prototype.emit=function(t,i){var n=this.events;n[t]&&h.setEvent(n[t],i)},t.prototype.finishLoad=function(){this.isPullingDown?this._finishPullDown():this.onPullUpLoading&&this._finishPullUp()},t.prototype.refresh=function(){this._init()},t.prototype.destory=function(){this.destory=!0;var t=h.setEvent,i=this.container;e(this.wrapper,"scroll",t.bind(this.wrapper,this._onScroll)),e(i,"touchstart",t.bind(i,this._touchStart)),e(i,"touchmove",t.bind(i,this._touchMove)),e(i,"touchend",t.bind(i,this._touchEnd)),e(i,"touchcancel",t.bind(i,this._touchEnd)),this.wrapper=null,this.container=null}}(c),function(t){t.prototype._pullingUpLoad=function(){this.onPullUpLoading=!0,this.emit("loadMore")},t.prototype._finishPullUp=function(){this.onPullUpLoading=!1},t.prototype._pullingFresh=function(){this.isPullingDown=!0,this.beforePulldingDown=!1,this.onTouch=!1,r(this.touchDistanceY,this.constructor.PULLDOWN_FRESH,-10,this._touchMoveY.bind(this)),this.emit("refresh")},t.prototype._finishPullDown=function(){var t=this;this.isPullingDown=!1,setTimeout(function(){t.beforePulldingDown=!0},this.constructor.PULLDOWN_BACK_TIME),this._resetTouch()}}(c),function(t){t.prototype._onScroll=function(){var t=this.wrapper,i=this._pullUpLoad.threshold||this.constructor.PULLDONG_LOAD_THRESHOLD;t.scrollTop+t.offsetHeight+i>=t.scrollHeight&&!this.onPullUpLoading&&this._pullingUpLoad()},t.prototype._touchStart=function(t){var i=t.touches[0];this.startY=i.clientY,this.onTouch=!0,this._touchMoveY(0)},t.prototype._touchMove=function(t){if(!this.onTouch)return!1;var i=this.wrapper.scrollTop,n=t.touches[0].clientY,o=n-this.startY;return this.startY=n,0!==i||o<0&&0===this.touchDistanceY?this._touchEndHandler():(t.preventDefault(),this._touchMoveY(this.touchDistanceY+o),this.touchDistanceY>=this.constructor.PULLDOWN_TOP?this._pullingFresh():void 0)},t.prototype._touchEnd=function(){return this.touchDistanceY>=this.constructor.PULLDOWN_FRESH&&this.onTouch?this._pullingFresh():this._touchEndHandler(),this._session&&this._storeScroll()},t.prototype._touchEndHandler=function(){this.isPullingDown||(this.onTouch=!1,this.touchDistanceY>0&&this._resetTouch())},t.prototype._resetTouch=function(){r(this.touchDistanceY,0,-10,this._touchMoveY.bind(this))},t.prototype._touchMoveY=function(t){this.touchDistanceY=t,this.emit("touchMove",t)},t.prototype._storeScroll=function(){}}(c),c});
